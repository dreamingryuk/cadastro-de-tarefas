<!DOCTYPE html>
<html>
    <style>
        body {
            display: flex;
        }
        .cadastro {
            display: flex;
            flex-direction: column;
        }
        .lista {
            padding: 3%;
        }
        table {
            border: 1px solid
        }
    </style>
<body onload="atualizar()">
    <div class="cadastro">
        <label for="codigobarras">Código de Barras</label>
        <input id="codigobarras" />
        <label for="nome">Nome</label>
        <input id="nome" />
        <label for="valor">Valor</label>
        <input id="valor" />

        <button onclick="salvar()">Salvar</button>
    </div>
    <div class="lista">
        <!-- <button onclick="atualizar()">Atualizar Lista</button> -->
        <div id="lista">

        </div>
        
    </div>
    

    <script>
        const urlBase = 'http://159.65.228.63/';
        var dados = []

        async function atualizar() {
            const response = await fetch(urlBase+'produtos')
            dados = await response.json();
            criarTabela(dados)
        }

        function criarTabela(produtos) {
            document.getElementById("lista").innerHTML = "";
            const table = document.createElement("table");
            table.setAttribute("border", "1");

            const row = document.createElement("tr");
            const td1 = document.createElement("th");
            td1.textContent = 'ID';
            const td2 = document.createElement("th");
            td2.textContent = 'Código de Barras';
            const td3 = document.createElement("th");
            td3.textContent = 'Nome';
            const td4 = document.createElement("th");
            td4.textContent = 'Valor';
            row.appendChild(td1);
            row.appendChild(td2);
            row.appendChild(td3);
            row.appendChild(td4);
            table.appendChild(row);
            
            for (const produto of produtos) {
                const rowDados = document.createElement("tr");
                const tdId = document.createElement("td");
                const tdCodBarras = document.createElement("td");
                const tdNome = document.createElement("td");
                const tdValor = document.createElement("td");
                tdId.textContent = produto.id;
                tdCodBarras.textContent = produto.codBarras
                tdNome.textContent = produto.nome
                tdValor.textContent = produto.valor

                rowDados.appendChild(tdId);
                rowDados.appendChild(tdCodBarras);
                rowDados.appendChild(tdNome)
                rowDados.appendChild(tdValor)
                table.appendChild(rowDados)
            }
            const container = document.getElementById('lista');
            container.appendChild(table);
        }

        async function salvar(){
            if (document.getElementById('codigobarras').value == '') {
                alert('Código de barras inválido');
                return
            }
            if (document.getElementById('nome').value == '') {
                alert('Nome inválido');
                return
            }
            if (document.getElementById('valor').value == '') {
                alert('Valor inválido');
                return
            }

            for (const produto of dados) {
                if (document.getElementById('nome').value == produto.nome) {
                    console.log(document.getElementById('nome').value, produto.nome)
                    alert('Produto ja está na lista')
                    return
                }
            }

            const dadosInsert = {
                codBarras: document.getElementById('codigobarras').value,
                nome: document.getElementById('nome').value,
                valor: document.getElementById('valor').value
            }

            await fetch(urlBase+'produtos', {
                method: 'POST',
                headers: {
                    'content-type': 'application/json'
                },
                body: JSON.stringify(dadosInsert)
            })

            atualizar()

            alert('Produto salvo :)')
        }
        
    </script>
</body>